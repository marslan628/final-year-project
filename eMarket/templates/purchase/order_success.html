{% extends 'base.html' %}
{% block title %}Order Confirmation | eMarket{% endblock %}

{% block content %}
<!-- Bootstrap 5 CDN (if not already in base.html) -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

<div class="container py-5">
  <div class="card shadow-lg p-5 rounded-4 mx-auto" style="max-width: 900px;">
    <div class="text-center mb-4">
      <h2 class="text-success fw-bold">Order Confirmed!</h2>
      <p class="text-muted">Thank you for your purchase at <strong>eMarket.pk</strong></p>
    </div>

    <div class="alert alert-primary text-center mb-4">
      <h5 class="mb-0">Hi {{ order.user.get_full_name }}! Your order <strong>#{{ order.id }}</strong> has been confirmed.</h5>
    </div>

    <hr class="mb-4">

    <!-- Customer Info -->
    <h5 class="mb-3 text-dark">Customer & Shipping Info</h5>
    <ul class="list-group list-group-flush mb-4">
      <li class="list-group-item d-flex justify-content-between"><strong>Full Name:</strong> <span>{{ order.full_name }}</span></li>
      <li class="list-group-item d-flex justify-content-between"><strong>Email:</strong> <span>{{ order.email }}</span></li>
      <li class="list-group-item d-flex justify-content-between"><strong>Phone:</strong> <span>{{ order.phone }}</span></li>
      <li class="list-group-item d-flex justify-content-between"><strong>Address:</strong> <span>{{ order.address }}</span></li>
      <li class="list-group-item d-flex justify-content-between"><strong>City:</strong> <span>{{ order.city }}</span></li>
      <li class="list-group-item d-flex justify-content-between"><strong>Zip Code:</strong> <span>{{ order.zip_code }}</span></li>
      <li class="list-group-item d-flex justify-content-between"><strong>Order Date:</strong> <span>{{ order.created_at|date:"F d, Y - h:i A" }}</span></li>
    </ul>

    <!-- Products -->
    <h5 class="mb-3 text-dark">Ordered Products</h5>
    <ul class="list-group mb-4">
      {% for item in order.items.all %}
      <li class="list-group-item">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <strong>{{ item.product.name }}</strong><br>
            <small class="text-muted">Price: Rs. {{ item.price|floatformat:2 }}</small><br>
            {% if item.color %}<small class="text-muted">Color: {{ item.color }}</small><br>{% endif %}
            {% if item.size %}<small class="text-muted">Size: {{ item.size }}</small><br>{% endif %}
          </div>
          <div class="text-end">
            <span class="badge bg-secondary">Qty: {{ item.quantity }}</span><br>
            <span class="fw-bold text-dark">Rs. {{ item.price|floatformat:2 }}</span>
          </div>
        </div>
      </li>
      {% empty %}
      <li class="list-group-item text-center text-muted">No items found in this order.</li>
      {% endfor %}
    </ul>

    <!-- Payment Info -->
    <h5 class="mb-3 text-dark">Payment Information</h5>
    <ul class="list-group list-group-flush mb-4">
      <li class="list-group-item d-flex justify-content-between">
        <strong>Card Number:</strong>
        <span>**** **** **** {{ order.payment.card_number|slice:"-4:" }}</span>
      </li>
      <li class="list-group-item d-flex justify-content-between">
        <strong>Expiry Date:</strong> <span>{{ order.payment.expiry }}</span>
      </li>
      <li class="list-group-item d-flex justify-content-between">
        <strong>Total Paid:</strong> 
        <span class="text-success fw-bold">Rs. {{ order.total_amount|floatformat:2 }}</span>
      </li>
      <li class="list-group-item d-flex justify-content-between">
        <strong>Order Status:</strong> 
        <span class="badge bg-info text-dark">{{ order.status }}</span>
      </li>
    </ul>

    <!-- Actions -->
    <div class="text-center mt-4 d-grid gap-2 d-sm-flex justify-content-sm-center">
      <a href="{% url 'home' %}" class="btn btn-outline-primary px-4 rounded-pill">
        <i class="bi bi-house-door-fill"></i> Back to Home
      </a>
      <a href="{% url 'shop' %}" class="btn btn-outline-success px-4 rounded-pill">
        <i class="bi bi-cart-fill"></i> Continue Shopping
      </a>
      <a href="{%url 'my_orders'%}" class="btn btn-outline-secondary px-4 rounded-pill">
        <i class="bi bi-receipt-cutoff"></i> My Orders
      </a>
    </div>
  </div>
</div>
{% endblock %}
