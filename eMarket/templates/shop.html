{% extends 'base.html' %}
{% load static %}
{% block content %}

<!-- Bootstrap Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

<style>
  .card-hover:hover {
    transform: translateY(-4px);
    transition: all 0.3s ease;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
  }

  .card-img-top {
    height: 220px;
    object-fit: cover;
    border-top-left-radius: 0.5rem;
    border-top-right-radius: 0.5rem;
  }

  .filter-box {
    background-color: #fff;
    border: 1px solid #ddd;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
  }

  .text-muted-small {
    font-size: 0.9rem;
    color: #6c757d;
  }

  .price-tag {
    font-size: 1rem;
    font-weight: 600;
    color: #28a745;
  }
</style>

<div class="container py-5">
  <div class="row">
    <!-- Sidebar -->
    <aside class="col-lg-3 mb-4">
      <div class="filter-box">
        <h5 class="fw-bold mb-4"><i class="bi bi-funnel-fill me-2"></i>Filters</h5>

        <!-- Search -->
        <form method="get">
          <div class="mb-4">
            <input type="text" name="q" value="{{ request.GET.q }}" class="form-control rounded" placeholder="ðŸ” Search products...">
          </div>

          <!-- Categories -->
          <div class="mb-4">
            <h6 class="fw-semibold">Categories</h6>
            <ul class="list-unstyled">
              <li><a href="{% url 'shop' %}" class="text-decoration-none {% if not selected_category %}fw-bold text-primary{% endif %}">All</a></li>
              {% for category in categories %}
                <li>
                  <a href="?category={{ category.id }}" class="text-decoration-none {% if selected_category == category.id %}fw-bold text-primary{% endif %}">
                    {{ category.name }}
                  </a>
                </li>
              {% endfor %}
            </ul>
          </div>

          <!-- Sort -->
          <div class="mb-3">
            <h6 class="fw-semibold">Sort by</h6>
            <select name="sort" class="form-select" onchange="this.form.submit()">
              <option value="">Default</option>
              <option value="price_low" {% if request.GET.sort == 'price_low' %}selected{% endif %}>Price: Low to High</option>
              <option value="price_high" {% if request.GET.sort == 'price_high' %}selected{% endif %}>Price: High to Low</option>
            </select>
          </div>
        </form>
      </div>
    </aside>

    <!-- Product Grid -->
    <section class="col-lg-9">
      <div class="row g-4">
        {% if products %}
          {% for product in products %}
            <div class="col-md-6 col-lg-4">
              <div class="card card-hover h-100 border-0 shadow-sm rounded-4">
                <img src="{{ product.image.url }}" class="card-img-top" alt="{{ product.name }}">
                <div class="card-body">
                  <h6 class="fw-semibold mb-2">{{ product.name|truncatechars:30 }}</h6>
                  <p class="text-muted-small mb-2">{{ product.short_details|truncatechars:60 }}</p>
                  <div class="d-flex justify-content-between align-items-center">
                    <span class="price-tag">PKR {{ product.base_price|floatformat:0 }}</span>
                    <a href="{% url 'product_detail' product.slug %}" class="btn btn-outline-primary btn-sm rounded-pill">View Details</a>
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        {% else %}
          <div class="col-12">
            <div class="alert alert-info text-center shadow-sm rounded">No products found. Try adjusting filters or search.</div>
          </div>
        {% endif %}
      </div>
    </section>
  </div>
</div>

{% endblock %}
